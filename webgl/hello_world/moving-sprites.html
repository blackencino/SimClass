
<!DOCTYPE html>

<!--
   Using the fast sprite renderer to display the output of a simulation.
-->

<html>
<head>
<meta charset="UTF-8">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<title>Sprite Drawing of Simulation Data WebGL</title>
<style>
    label {
        margin-left: 30px;
    }
</style>
</head>

<body>

<h2>Moving Sprites with the WebGL drawArraysInstanced primitive</h2>

<noscript><p><b>Sorry, but this page requires JavaScript.</b></p></noscript>

<p>
    <label><b><input type="checkbox" id="animateCheckbox">&nbsp;Animate</b></label>
    <label><b><input type="checkbox" id="colorCheckbox">&nbsp;Random&nbsp;Colors</b></label>
    <label><b>Point Size:</b>&nbsp;<select id="sizeChoice">
        <option value="16">Small</option>
        <option value="32">Medium</option>
        <option value="64">Large</option>
    </select></label>
</p>

<div id="canvas-holder">
<canvas id="webglcanvas" width="800" height="600"></canvas>
</div>


<script type="module">
import {Simple_simulation} from "./simulation.js";
import {get_gl_context_bundle, Simple_simulation_renderer} from "./sprite_renderer.js";

"use strict";
//------------------------------------------------------------------------------
// Initialize the program.
// This function is called after the page has been loaded.
function init() {
    var canvas;
    var gl_context_bundle;
    var simulation;
    var simulation_renderer;
    try {
        canvas = document.getElementById("webglcanvas");
        gl_context_bundle = get_gl_context_bundle(canvas);
    } catch (e) {
        document.getElementById("canvas-holder").innerHTML =
            "<p>Sorry, could not get a WebGL graphics context.</p>";
        return;
    }

    simulation = new Simple_simulation({
            count: 1000,
            support: 15.0,
            width: canvas.width,
            height: canvas.height,
        });

    try {
        simulation_renderer = new Simple_simulation_renderer(
            gl_context_bundle,
            simulation
        );
    } catch (e) {
        document.getElementById("canvas-holder").innerHTML =
            "<p>Sorry, could not initialize the WebGL graphics context:" +
            e +
            "</p>";
        return;
    }

    var prev_time = performance.now();
    var do_frame = function(new_time) {
        const delta_time = new_time - prev_time;
        prev_time = new_time;
        simulation.step(0.001 * delta_time);
        simulation_renderer.update_buffers(simulation);
        simulation_renderer.render({ width: canvas.width, height: canvas.height });
        requestAnimationFrame(do_frame);
    };
    requestAnimationFrame(do_frame);
}

init();

</script>

</body>
</html>
